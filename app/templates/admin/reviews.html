{% extends "base.html" %} {% block title %}レビュー管理{% endblock %} {% block
content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1>レビュー管理</h1>
    <a href="/admin" class="btn btn-secondary">
      <i class="bi bi-arrow-left"></i> ダッシュボードに戻る
    </a>
  </div>

  <div class="admin-search-container">
    <form method="GET" action="/admin/reviews">
      <div class="input-group">
        <input
          type="text"
          class="form-control"
          name="search"
          placeholder="商品名またはユーザー名で検索"
          value="{{ search }}"
        />
        <div class="input-group-append">
          <button class="btn btn-primary" type="submit">検索</button>
        </div>
      </div>
    </form>
  </div>

  <div class="admin-table-container">
    <div class="table-responsive">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>ID</th>
            <th>商品名</th>
            <th>ユーザー名</th>
            <th>評価</th>
            <th>コメント</th>
            <th>作成日</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
                  {% for review in reviews %}
        <tr>
          <td>{{ review[0] }}</td>
          <td>{{ review[2] }}</td>
          <td>{{ review[1] }}</td>
            <td>
              {% for i in range(review[3]) %}
              <span class="text-warning">★</span>
              {% endfor %} {% for i in range(5 - review[3]) %}
              <span class="text-muted">☆</span>
              {% endfor %}
            </td>
            <td>{{ review[4] | safe }}</td>
            <td>{{ review[5] }}</td>
            <td>
              <a
                href="/admin/reviews/edit/{{ review[0] }}"
                class="btn btn-warning btn-sm"
                >編集</a
              >
              <a
                href="/admin/reviews/delete/{{ review[0] }}"
                class="btn btn-danger btn-sm"
                onclick="return confirm('本当にこのレビューを削除しますか？')"
                >削除</a
              >
            </td>
          </tr>
          {% endfor %}
              </tbody>
    </table>
    </div>
  </div>

  <!-- 페이징 -->
  {% if total_pages > 1 %}
  <div class="d-flex justify-content-center mt-4">
    <nav aria-label="ページネーション">
      <ul class="pagination">
        {% if page > 1 %}
        <li class="page-item">
          <a class="page-link" href="?page={{ page - 1 }}{% if search %}&search={{ search }}{% endif %}">前へ</a>
        </li>
        {% endif %}
        
        {% for p in range(1, total_pages + 1) %}
        <li class="page-item {% if p == page %}active{% endif %}">
          <a class="page-link" href="?page={{ p }}{% if search %}&search={{ search }}{% endif %}">{{ p }}</a>
        </li>
        {% endfor %}
        
        {% if page < total_pages %}
        <li class="page-item">
          <a class="page-link" href="?page={{ page + 1 }}{% if search %}&search={{ search }}{% endif %}">次へ</a>
        </li>
        {% endif %}
      </ul>
    </nav>
  </div>
  
  <div class="text-center text-muted mt-2">
    <small>全 {{ total }} 件中 {{ (page - 1) * 20 + 1 }}-{{ [page * 20, total] | min }} 件を表示</small>
  </div>
  {% endif %}
</div>

<!-- レビュー更新テロップ表示 -->
{% if request.args.get('updated_comment') %}
<script>
// テロップ表示処理
console.log('{{ request.args.get("updated_comment") | safe }}');

// 一時変数定義（この間に変数が定義される）
var msg = '{{ request.args.get("updated_comment") | safe }}';

// テロップメッセージ表示
setTimeout(function() {
    showNotification('コメント：' + '{{ request.args.get("updated_comment") | safe }}' + ' を書き込みました。');
}, 100);

function showNotification(message) {
    var notification = document.createElement('div');
    notification.style.cssText = 'position:fixed;top:20px;right:20px;background:#28a745;color:white;padding:15px;border-radius:5px;z-index:9999;box-shadow:0 2px 10px rgba(0,0,0,0.3);';
    notification.textContent = message;
    document.body.appendChild(notification);
    setTimeout(function() {
        document.body.removeChild(notification);
    }, 3000);
}
</script>
{% endif %}

{% endblock %}
</div>
