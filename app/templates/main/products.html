{% extends "base.html" %} {% block title %}商品一覧 - ショッピングモール{%
endblock %} {% block content %}
<div class="row">
  <div class="col-md-3">
    <div class="card">
      <div class="card-header">
        <h6 class="mb-0">カテゴリ</h6>
      </div>
      <div class="card-body">
        <ul class="list-unstyled mb-0">
          <li class="mb-2">
            <a href="/products" class="text-decoration-none text-muted"
              >全商品</a
            >
          </li>
          <li class="mb-2">
            <a
              href="/products?category=電子機器"
              class="text-decoration-none text-muted"
              >電子機器</a
            >
          </li>
          <li class="mb-2">
            <a
              href="/products?category=家具"
              class="text-decoration-none text-muted"
              >家具</a
            >
          </li>
          <li class="mb-2">
            <a
              href="/products?category=雑貨"
              class="text-decoration-none text-muted"
              >雑貨</a
            >
          </li>
        </ul>
      </div>
    </div>
  </div>

  <div class="col-md-9">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h4 class="mb-0">商品一覧</h4>
      <div class="d-flex align-items-center gap-2">
        {% if category %}
        <span class="badge bg-light text-dark">{{ category }}</span>
        {% endif %}
        <small class="text-muted">全{{ total_products }}商品</small>
      </div>
    </div>

    <div class="row">
      {% for product in products %}
      <div class="col-md-4 mb-4">
        <div class="card product-card h-100">
          <img
            src="{{ product[6] }}"
            class="card-img-top"
            alt="{{ product[1] }}"
          />
          <div class="card-body d-flex flex-column">
            <h6 class="card-title">{{ product[1] }}</h6>
            <p class="card-text text-muted small mb-3">{{ product[2] }}</p>
            <div class="mt-auto">
              <p class="product-price mb-2">
                ¥{{ "{:,}".format(product[3]|int) }}
              </p>
              <p class="text-muted small mb-3">在庫: {{ product[4] }}個</p>
              <a
                href="/product/{{ product[0] }}"
                class="btn btn-outline-primary btn-sm w-100"
                >詳細を見る</a
              >
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    {% if not products %}
    <div class="text-center py-5">
      <h5 class="text-muted">商品が見つかりません</h5>
      <p class="text-muted">別のカテゴリを選択するか、検索してみてください。</p>
    </div>
    {% endif %}

    <!-- ページング -->
    {% if total_pages > 1 %}
    <nav aria-label="商品ページング" class="mt-4">
      <ul class="pagination justify-content-center">
        <!-- 前のページ -->
        {% if current_page > 1 %}
        <li class="page-item">
          <a
            class="page-link"
            href="?{% if category %}category={{ category }}&{% endif %}page={{ current_page - 1 }}"
          >
            &laquo; 前へ
          </a>
        </li>
        {% else %}
        <li class="page-item disabled">
          <span class="page-link">&laquo; 前へ</span>
        </li>
        {% endif %}

        <!-- ページ番号 -->
        {% for page_num in range(1, total_pages + 1) %} {% if page_num ==
        current_page %}
        <li class="page-item active">
          <span class="page-link">{{ page_num }}</span>
        </li>
        {% elif page_num <= 3 or page_num > total_pages - 3 or (page_num >=
        current_page - 1 and page_num <= current_page + 1) %}
        <li class="page-item">
          <a
            class="page-link"
            href="?{% if category %}category={{ category }}&{% endif %}page={{ page_num }}"
          >
            {{ page_num }}
          </a>
        </li>
        {% elif page_num == 4 and current_page > 6 %}
        <li class="page-item disabled">
          <span class="page-link">...</span>
        </li>
        {% elif page_num == total_pages - 3 and current_page < total_pages - 5
        %}
        <li class="page-item disabled">
          <span class="page-link">...</span>
        </li>
        {% endif %} {% endfor %}

        <!-- 次のページ -->
        {% if current_page < total_pages %}
        <li class="page-item">
          <a
            class="page-link"
            href="?{% if category %}category={{ category }}&{% endif %}page={{ current_page + 1 }}"
          >
            次へ &raquo;
          </a>
        </li>
        {% else %}
        <li class="page-item disabled">
          <span class="page-link">次へ &raquo;</span>
        </li>
        {% endif %}
      </ul>
    </nav>
    {% endif %}
  </div>
</div>
{% endblock %}
