{% extends "base.html" %} {% block title %}ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›† -
è„†å¼±ãªã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ«{% endblock %} {% block content %}
<div class="row">
  <div class="col-md-8 mx-auto">
    <div class="card">
      <div class="card-header">
        <h3 class="mb-0">âœï¸ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†</h3>
      </div>
      <div class="card-body">
        {% if user %}
        <form
          method="POST"
          action="/user/profile/edit"
          enctype="multipart/form-data"
        >
          <div class="row">
            <div class="col-md-4 text-center mb-4">
              <div class="mb-3">
                {% if user[8] %}
                <img
                  src="{{ url_for('static', filename=user[8]) }}"
                  alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ"
                  class="img-fluid rounded-circle"
                  style="width: 150px; height: 150px; object-fit: cover"
                />
                {% else %}
                <div
                  class="bg-light rounded-circle d-flex align-items-center justify-content-center mx-auto"
                  style="width: 150px; height: 150px"
                >
                  <span class="text-muted">ç”»åƒãªã—</span>
                </div>
                {% endif %}
              </div>
              <div class="mb-3">
                <label for="profile_image" class="form-label"
                  >ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ</label
                >
                <input
                  type="file"
                  class="form-control"
                  id="profile_image"
                  name="profile_image"
                />
                <div class="form-text">
                  ä»»æ„ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ (è„†å¼±æ€§ãƒ†ã‚¹ãƒˆç”¨)
                </div>
              </div>
            </div>
            <div class="col-md-8">
              <div class="mb-3">
                <label for="username" class="form-label">ãƒ¦ãƒ¼ã‚¶ãƒ¼å</label>
                <input
                  type="text"
                  class="form-control"
                  id="username"
                  value="{{ user[1] }}"
                  readonly
                />
                <div class="form-text">ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¯å¤‰æ›´ã§ãã¾ã›ã‚“</div>
              </div>

              <div class="mb-3">
                <label for="email" class="form-label">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                <input
                  type="email"
                  class="form-control"
                  id="email"
                  name="email"
                  value="{{ user[3] if user[3] else '' }}"
                  required
                />
              </div>

              <div class="mb-3">
                <label for="address" class="form-label">ä½æ‰€</label>
                <textarea
                  class="form-control"
                  id="address"
                  name="address"
                  rows="3"
                >
{{ user[4] if user[4] else '' }}</textarea
                >
              </div>

              <div class="mb-3">
                <label for="phone" class="form-label">é›»è©±ç•ªå·</label>
                <input
                  type="tel"
                  class="form-control"
                  id="phone"
                  name="phone"
                  value="{{ user[5] if user[5] else '' }}"
                />
              </div>
            </div>
          </div>

          <div class="d-flex gap-2">
            <button type="submit" class="btn btn-primary">ğŸ’¾ æ›´æ–°</button>
            <a href="/user/profile" class="btn btn-secondary">
              âŒ ã‚­ãƒ£ãƒ³ã‚»ãƒ«
            </a>
          </div>
        </form>
        {% else %}
        <div class="alert alert-warning">
          <strong>âš ï¸ è­¦å‘Š:</strong> ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚
        </div>
        <a href="/user/profile" class="btn btn-primary">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã«æˆ»ã‚‹</a>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<script>
  // ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½
  document
    .getElementById("profile_image")
    .addEventListener("change", function (e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          const img =
            document.querySelector(".img-fluid.rounded-circle") ||
            document.querySelector(".bg-light.rounded-circle");
          if (img.tagName === "IMG") {
            img.src = e.target.result;
          } else {
            // ç”»åƒãŒãªã„å ´åˆã€æ–°ã—ã„imgè¦ç´ ã‚’ä½œæˆ
            const newImg = document.createElement("img");
            newImg.src = e.target.result;
            newImg.alt = "ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ";
            newImg.className = "img-fluid rounded-circle";
            newImg.style = "width: 150px; height: 150px; object-fit: cover;";
            img.parentNode.replaceChild(newImg, img);
          }
        };
        reader.readAsDataURL(file);
      }
    });
</script>
{% endblock %}
